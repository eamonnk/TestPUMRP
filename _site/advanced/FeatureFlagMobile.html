<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>PartsUnlimited : Feature Flag for a Mobile Solution</title>
        <meta name="description" content="example e-commerce website">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/PartsUnlimited/css/syntax.css">
        <link rel="stylesheet" href="/PartsUnlimited/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <img class="logo" src="/PartsUnlimited/assets/logo-ms-dark.png" alt="Microsoft">
<h4><a class="brand" href="/PartsUnlimited/">PartsUnlimited</a>
    <small>example e-commerce website</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    
        <li><a href="/PartsUnlimited/">Welcome</a></li>
    

    
        
        

        
            
                <li class="nav-header">Basic DevOps Practices</li>
            

            
                <li data-order="3"><a href="/PartsUnlimited/basic/manual-deployment.html">Manual Deployment</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimited/basic/ci.html">Continuous Integration</a></li>
            
        
            

            
                <li data-order="5"><a href="/PartsUnlimited/basic/cd.html">Continuous Deployment</a></li>
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimited/basic/QuickStart.html">Quick Start</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimited/basic/GettingStartedLinuxOSX.html">Getting Started on Linux and OSX</a></li>
            
        
            

            
                <li data-order="0"><a href="/PartsUnlimited/basic/GettingStarted.html">Getting Started</a></li>
            
        
    
        
        

        
            
                <li class="nav-header">Advanced DevOps Practices</li>
            

            
                <li data-order="0"><a href="/PartsUnlimited/advanced/UserTelemetry.html">User Telemetry</a></li>
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimited/advanced/UsageAnalysis.html">Usage Analysis</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimited/advanced/TestingProd.html">Testing in Production</a></li>
            
        
            

            
                <li data-order="6"><a href="/PartsUnlimited/advanced/FeatureFlagWebAdvanced.html">Advanced Feature Flag for Web Applications</a></li>
            
        
            

            
                <li data-order="5"><a href="/PartsUnlimited/advanced/FeatureFlagWeb.html">Feature Flag for Web Applications</a></li>
            
        
            

            
                <li data-order="7"><a class="nav-active" href="/PartsUnlimited/advanced/FeatureFlagMobile.html">Feature Flag for a Mobile Solution</a></li>  
            
        
            

            
                <li data-order="8"><a href="/PartsUnlimited/advanced/FeatureFlagAPI.html">Feature Flag for an API</a></li>
            
        
            

            
                <li data-order="11"><a href="/PartsUnlimited/advanced/FaultInjectionServiceFabricStarter.html">Fault Injection for Service Fabric Hackathon Starter</a></li>
            
        
            

            
                <li data-order="10"><a href="/PartsUnlimited/advanced/FaultInjectionServiceFabric.html">Fault Injection for Service Fabric</a></li>
            
        
            

            
                <li data-order="9"><a href="/PartsUnlimited/advanced/FaultInjectionAzurePaaS.html">Fault Injection for Azure PaaS</a></li>
            
        
            

            
                <li data-order="3"><a href="/PartsUnlimited/advanced/ErrorReporting.html">Error Reporting</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimited/advanced/ABTesting.html">Experimentation and A/B Testing with Optimzely</a></li>
            
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div class="page-header">
    <h2>Feature Flag for a Mobile Solution
        
    </h2>
</div>

<h1 id="hol---feature-flag-for-a-mobile-solution">HOL - Feature Flag for a Mobile Solution</h1>

<p>In this lab you will work with a simple Xamarin Forms mobile application. Your task is to add a feature flag and then bind it to the app’s logic.</p>

<h2 id="pre-requisites">Pre-requisites:</h2>

<ul>
  <li>
    <p>Visual Studio 2015 Update 3</p>
  </li>
  <li>
    <p><a href="https://developer.microsoft.com/en-us/windows/downloads/sdk-archive">Windows SDK and emulator</a> installed</p>
  </li>
  <li>
    <p><a href="https://developer.android.com/studio/index.html">Android SDK</a> and <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">Java 1.8 JDK</a> installed</p>
  </li>
  <li>
    <p><a href="https://www.visualstudio.com/vs/msft-android-emulator/">Visual Studio Emulator for Android</a> installed.</p>
  </li>
  <li>
    <p><a href="https://developer.xamarin.com/guides/cross-platform/windows/visual-studio/">Xamarin</a> installed and set up for Visual Studio.</p>

    <blockquote>
      <p><strong>Note:</strong> This includes <a href="https://developer.xamarin.com/guides/ios/getting_started/installation/windows/connecting-to-mac/">Mac setup</a>, if you have intentions to run iOS app.</p>
    </blockquote>
  </li>
  <li>
    <p>PartsUnlimited website deployed to Microsoft Azure (see <a href="https://github.com/Microsoft/PartsUnlimited/blob/master/docs/Deployment.md">link</a>)</p>
  </li>
</ul>

<h2 id="tasks-overview">Tasks Overview:</h2>

<p><strong>1. Clone repository using Git</strong> This task will show you how to clone a repository from github to your machine using a command line with git.</p>

<p><strong>2. Open and Run the mobile app</strong> In this task you will use Visual studio to open PartsUnlimited’s Xamarin solution and a then run it on an Android emulator.</p>

<p><strong>3. Adding feature flag to the mobile app</strong> In this task you will modify and add code to the Xamarin application to create a discount feature flag.</p>

<p><strong>4. Validate that feature flag is operational</strong> In this task you will check that discount is applied to the products’ prices when the feature flag is toggled.</p>

<h2 id="tasks">Tasks</h2>
<h3 id="task-1-clone-repository-using-git">Task 1: Clone repository using Git</h3>
<p>Let’s get the PartsUnlimited’s source code. If you already have the source code on your machine then skip to the next task.</p>

<p>Clone the repository to a local directory.</p>

<p><strong>Step 1.</strong> Open a command line (one that supports Git) and navigate to the directory where you want to store your local repositories. For example you can create and navigate to <code class="highlighter-rouge">C:\Source\Repos</code>.</p>

<p><strong>Step 2.</strong> Clone the repository with the following command:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>	git clone https://github.com/Microsoft/PartsUnlimited.git
</code></pre>
</div>

<blockquote>
  <p>After a few seconds of downloading, all of the code should now be on your local machine.</p>
</blockquote>

<h3 id="task-2-open-and-run-the-mobile-app">Task 2: Open and run the mobile app</h3>

<p><strong>Step 1.</strong> Open Visual Studio as administrator. Open Start menu, locate Visual Studio 2015, right click on it, select “More” and then click on “Run as administrator”.</p>

<p><img src="/PartsUnlimited/assets/featureflagmobile/1.png" alt="" /></p>

<p><strong>Step 2.</strong> Open mobile app solution.</p>

<ol>
  <li>
    <p>Click on “File”, “Open” and then “Project/Solution”.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/2.png" alt="" /></p>
  </li>
  <li>
    <p>Navigate to the directory where you cloned the repository, select “PartsUnlimited.Mobile.sln” and click on “Open”.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/3.png" alt="" /></p>
  </li>
  <li>
    <p>If you haven’t done so already, you will be prompted to connect to a Mac machine.</p>
    <blockquote>
      <p><strong>Note:</strong> Connection to a Mac machine is only required if you want to compile and run iOS applications. To connect Mac to your Visual Studio instance follow these instructions: <a href="https://developer.xamarin.com/guides/ios/getting_started/installation/windows/connecting-to-mac/">Xamarin: Connecting to the Mac</a></p>
    </blockquote>
  </li>
</ol>

<p><strong>Step 3.</strong> You should be able to build and run the solution on iOS, Android and UWP (Windows Phone 10 or Windows 10). Let’s run it on Android emulator.</p>

<ol>
  <li>
    <p>Right click on “PartsUnlimited.Droid” project, then on “Set as StartUp Project”.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/4.png" alt="" /></p>
  </li>
  <li>
    <p>Clean the solution. Right click on the solution and select “Clean Solution”.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/13.png" alt="" /></p>
  </li>
  <li>
    <p>Rebuild the solution. Right click on the solution and select “Rebuild Solution”.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/14.png" alt="" /></p>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong>
<br />1) If packages haven’t been restored properly then run the following command in Visual Studio’s Package Manager Console: <code class="highlighter-rouge">Update-Package –reinstall</code>
<br />2) If you had multiple Java JDK versions installed at the time of setting up Xamarin, then you have to make sure that Visual studio is using Java SDK version 8 in Tools &gt; Options &gt; Xamarin
<img src="/PartsUnlimited/assets/featureflagmobile/15.png" alt="" /></p>
</blockquote>

<ol>
  <li>
    <p>Select the emulator you want to run this app on and click on green triangle to run the application.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/5.png" alt="" /></p>
  </li>
  <li>
    <p>You should see the following main screen in your emulator:</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/6.png" alt="" /></p>
  </li>
</ol>

<blockquote>
  <p><strong>Note:</strong> Similarly, you should be able to run this application on UWP and iOS platforms.</p>
</blockquote>

<h3 id="task-3-adding-feature-flag-to-the-mobile-app">Task 3: Adding feature flag to the mobile app</h3>

<p>In this task you will add a feature flag that increases discount for all products that are on special.</p>

<p><strong>Step 1.</strong> Let’s add a bool variable which will be accessible everywhere within the application and represent whether feature flag is enabled.</p>

<ol>
  <li>
    <p>If you are still running the application then stop it by clicking on the red square in Visual Studio’s tool bar or by pressing <code class="highlighter-rouge">Shift+F5</code>.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/16.png" alt="" /></p>
  </li>
  <li>
    <p>Open “GlobalResources” class located at <b><code class="highlighter-rouge">PartsUnlimited</code> &gt; <code class="highlighter-rouge">Resources</code> &gt; <code class="highlighter-rouge">GlobalResources.cs</code> </b>.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/7.png" alt="" /></p>
  </li>
  <li>
    <p>Add the following code:</p>

    <div class="language-csharp highlighter-rouge"><pre class="highlight"><code> <span class="p">...</span>
 <span class="k">private</span> <span class="kt">bool</span> <span class="n">_enableDiscountFeatureFlag</span><span class="p">;</span>
 <span class="k">public</span> <span class="kt">bool</span> <span class="n">EnableDiscountFeatureFlag</span>
 <span class="p">{</span>
     <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_enableDiscountFeatureFlag</span><span class="p">;</span> <span class="p">}</span>
     <span class="k">set</span>
     <span class="p">{</span>
         <span class="n">_enableDiscountFeatureFlag</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
         <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="nf">nameof</span><span class="p">(</span><span class="n">EnableDiscountFeatureFlag</span><span class="p">));</span>
     <span class="p">}</span>
 <span class="p">}</span>
 <span class="p">...</span>
</code></pre>
    </div>
  </li>
  <li>
    <p>Change the value of <code class="highlighter-rouge">Website</code> variable to match the URL of your existing deployment of the PartsUnlimited website in Azure, e.g. http://pudncore.azurewebsites.net</p>
  </li>
</ol>

<p><strong>Step 2.</strong> The bool property you defined in the previous step, should be able to be set by a user, so let’s add a switch to the settings page.</p>

<ol>
  <li>
    <p>Open “SettingsPage.xaml” file located at <b><code class="highlighter-rouge">PartsUnlimited</code> &gt; <code class="highlighter-rouge">Views</code></b>.</p>

    <p><img src="/PartsUnlimited/assets/featureflagmobile/8.png" alt="" /></p>
  </li>
  <li>
    <p>Replace the whole “TableView” section with the following code:</p>

    <div class="language-csharp highlighter-rouge"><pre class="highlight"><code> <span class="p">...</span>
 <span class="p">&lt;</span><span class="n">TableView</span> <span class="n">Intent</span><span class="p">=</span><span class="s">"Settings"</span><span class="p">&gt;</span>
     <span class="p">&lt;</span><span class="n">TableSection</span> <span class="n">Title</span><span class="p">=</span><span class="s">"General"</span><span class="p">&gt;</span>
         <span class="p">&lt;</span><span class="n">TextCell</span> <span class="n">Text</span><span class="p">=</span><span class="s">"Website"</span> <span class="n">Detail</span><span class="p">=</span><span class="s">"{Binding Website, Source={x:Static resources:GlobalResources.Current}}"</span><span class="p">/&gt;</span>
         <span class="p">&lt;</span><span class="n">SwitchCell</span> <span class="n">On</span><span class="p">=</span><span class="s">"{Binding EnableDiscountFeatureFlag, Source={x:Static resources:GlobalResources.Current}}"</span> <span class="n">Text</span><span class="p">=</span><span class="s">"Extra Discount Feature Flag"</span><span class="p">/&gt;</span>
     <span class="p">&lt;/</span><span class="n">TableSection</span><span class="p">&gt;</span>
 <span class="p">&lt;/</span><span class="n">TableView</span><span class="p">&gt;</span>
 <span class="p">...</span>
</code></pre>
    </div>
    <blockquote>
      <p><strong>Note:</strong> SwitchCell is bound to the bool property you defined before, i.e. this switch will update that property every time its value is changed.</p>
    </blockquote>
  </li>
</ol>

<p><strong>Step 3.</strong> The last thing left to do is to define what this feature toggle should control/change. In this case, it will add extra 5% of discount to each product.</p>

<ol>
  <li>Open “ShoppingItemViewModel.cs” file located at <b><code class="highlighter-rouge">PartsUnlimited</code> &gt; <code class="highlighter-rouge">ViewModels</code></b>.</li>
</ol>

 	<img src="/PartsUnlimited/assets/featureflagmobile/9.png" alt="" />

<ol>
  <li>
    <p>Update “DiscountPercentage” property in the following way:</p>

    <div class="language-csharp highlighter-rouge"><pre class="highlight"><code> <span class="p">...</span>
 <span class="c1">/// &lt;summary&gt;
</span> <span class="c1">/// Gets or sets the discount percentage.
</span> <span class="c1">/// &lt;/summary&gt;
</span> <span class="k">public</span> <span class="kt">decimal</span> <span class="n">DiscountPercentage</span>
 <span class="p">{</span>
     <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">GlobalResources</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">EnableDiscountFeatureFlag</span> <span class="p">?</span> <span class="n">_discountPercentage</span> <span class="p">+</span> <span class="m">5</span> <span class="p">:</span> <span class="n">_discountPercentage</span><span class="p">;</span> <span class="p">}</span>
     <span class="k">set</span>
     <span class="p">{</span>
         <span class="n">_discountPercentage</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
         <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="nf">nameof</span><span class="p">(</span><span class="n">DiscountPercentage</span><span class="p">));</span>
         <span class="nf">OnPropertyChanged</span><span class="p">(</span><span class="nf">nameof</span><span class="p">(</span><span class="n">PriceAfterDiscount</span><span class="p">));</span>
     <span class="p">}</span>
 <span class="p">}</span>
 <span class="p">...</span>
</code></pre>
    </div>
  </li>
</ol>

<h3 id="task-4-validate-that-feature-flag-is-operational">Task 4: Validate that feature flag is operational</h3>

<p><strong>Step 1.</strong> Run the application again. Note the products’ prices before discount is increased. Now, click on ellipsis (<code class="highlighter-rouge">...</code>), then on the “Settings” option to navigate to the “Settings” page.</p>

<p><img src="/PartsUnlimited/assets/featureflagmobile/10.png" alt="" /></p>

<p><strong>Step 2.</strong> Turn on the feature flag and navigate back to the “Main” page.</p>

<p><img src="/PartsUnlimited/assets/featureflagmobile/11.png" alt="" /></p>

<p><strong>Step 3.</strong> You can now observe the feature flag in action.</p>

<p><img src="/PartsUnlimited/assets/featureflagmobile/12.png" alt="" /></p>

<blockquote>
  <p><strong>Note:</strong> By clicking on the product, the app will navigate you to the website specified in the <code class="highlighter-rouge">GlobalResource.cs</code> file.</p>
</blockquote>

<h2 id="congratulations-you-have-completed-this-lab">Congratulations, you have completed this lab.</h2>

<p>In this lab, you have learned how to define your own feature flag in a Xamarin Forms mobile app and how to bind a ViewModel’s property to achieve the desired outcome. Remember that feature flags can be as simple or as complicated as you wish them to be and even managed outside of your app by a service like <a href="https://launchdarkly.com/">LaunchDarkly</a>.</p>

<h2 id="next-steps">Next steps</h2>

<ul>
  <li><a href="FeatureFlagAPI">Feature Flag for an API</a></li>
</ul>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/Microsoft/PartsUnlimited">PartsUnlimited</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
