<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>PartsUnlimited : User Telemetry</title>
        <meta name="description" content="example e-commerce website">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/PartsUnlimited/css/syntax.css">
        <link rel="stylesheet" href="/PartsUnlimited/css/main.css">
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <img class="logo" src="/PartsUnlimited/assets/logo-ms-dark.png" alt="Microsoft">
<h4><a class="brand" href="/PartsUnlimited/">PartsUnlimited</a>
    <small>example e-commerce website</small>
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    
        <li><a href="/PartsUnlimited/">Welcome</a></li>
    

    
        
        

        
            
                <li class="nav-header">Basic DevOps Practices</li>
            

            
                <li data-order="3"><a href="/PartsUnlimited/basic/manual-deployment.html">Manual Deployment</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimited/basic/ci.html">Continuous Integration</a></li>
            
        
            

            
                <li data-order="5"><a href="/PartsUnlimited/basic/cd.html">Continuous Deployment</a></li>
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimited/basic/QuickStart.html">Quick Start</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimited/basic/GettingStartedLinuxOSX.html">Getting Started on Linux and OSX</a></li>
            
        
            

            
                <li data-order="0"><a href="/PartsUnlimited/basic/GettingStarted.html">Getting Started</a></li>
            
        
    
        
        

        
            
                <li class="nav-header">Advanced DevOps Practices</li>
            

            
                <li data-order="0"><a class="nav-active" href="/PartsUnlimited/advanced/UserTelemetry.html">User Telemetry</a></li>  
            
        
            

            
                <li data-order="2"><a href="/PartsUnlimited/advanced/UsageAnalysis.html">Usage Analysis</a></li>
            
        
            

            
                <li data-order="1"><a href="/PartsUnlimited/advanced/TestingProd.html">Testing in Production</a></li>
            
        
            

            
                <li data-order="6"><a href="/PartsUnlimited/advanced/FeatureFlagWebAdvanced.html">Advanced Feature Flag for Web Applications</a></li>
            
        
            

            
                <li data-order="5"><a href="/PartsUnlimited/advanced/FeatureFlagWeb.html">Feature Flag for Web Applications</a></li>
            
        
            

            
                <li data-order="7"><a href="/PartsUnlimited/advanced/FeatureFlagMobile.html">Feature Flag for a Mobile Solution</a></li>
            
        
            

            
                <li data-order="8"><a href="/PartsUnlimited/advanced/FeatureFlagAPI.html">Feature Flag for an API</a></li>
            
        
            

            
                <li data-order="11"><a href="/PartsUnlimited/advanced/FaultInjectionServiceFabricStarter.html">Fault Injection for Service Fabric Hackathon Starter</a></li>
            
        
            

            
                <li data-order="10"><a href="/PartsUnlimited/advanced/FaultInjectionServiceFabric.html">Fault Injection for Service Fabric</a></li>
            
        
            

            
                <li data-order="9"><a href="/PartsUnlimited/advanced/FaultInjectionAzurePaaS.html">Fault Injection for Azure PaaS</a></li>
            
        
            

            
                <li data-order="3"><a href="/PartsUnlimited/advanced/ErrorReporting.html">Error Reporting</a></li>
            
        
            

            
                <li data-order="4"><a href="/PartsUnlimited/advanced/ABTesting.html">Experimentation and A/B Testing with Optimzely</a></li>
            
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div class="page-header">
    <h2>User Telemetry
        
    </h2>
</div>

<p>#User Telemetry and Performance Monitoring with Application Insights</p>

<p>The marketing team has expressed interest in the behavior of users across the PartsUnlimited website for how to best market the products, especially how popular the web application is and where the users live. The development team would like to know which browsers and operating systems that most users browse to the site from to target better user experiences. The development team has also noticed that the recommendations page is slow to load and shows performance spikes in Application Insights telemetry. By viewing the details of performance monitoring through Application Insights, we will be able to drill down to the code that has affected the slow performance of the web application and fix the code.</p>

<p>Using the out-of-box telemetry for Application Insights, the teams will be able to find out how people use the application and gain insights into the goals that they will need to achieve.</p>

<p>In this lab, you will learn about setting up Application Insights to gain further insight into how users are behaving towards your web application, and drill down into performance monitoring data through Application Insights in the new Azure Portal.</p>

<p><strong>Prerequisites</strong></p>

<ul>
  <li>
    <p>Continuous Integration with Visual Studio Team Services (see <a href="https://github.com/Microsoft/PartsUnlimited/blob/master/docs/HOL-Continuous_Integration/README.md">link</a>)</p>
  </li>
  <li>
    <p>Continuous Deployment with Release Management in Visual Studio Team Services (see <a href="https://github.com/Microsoft/PartsUnlimited/blob/master/docs/HOL-Continuous_Deployment/README.md">link</a>)</p>
  </li>
  <li>
    <p>Application Insights created in the same Azure Resource Group as the PartsUnlimited website</p>
  </li>
  <li>
    <p>Continuous Integration build with deployment to the Azure web app</p>
  </li>
</ul>

<p><strong>Tasks Overview</strong></p>

<p><strong>1. Set up Application Insights for PartsUnlimited</strong> This will walk you through creating an Application Insights instance in Azure and connecting it to the PartsUnlimited solution.</p>

<p><strong>2. View real-time results for user telemetry in the Azure portal</strong> In this step you will be shown where to find all of the information collected by Application Insights.</p>

<p><strong>3. Using Application Performance Monitoring to resolve performance issues</strong> In this step you will investigate and resolve a performance issue with the help of Application Insights.</p>

<h3 id="task-1-set-up-application-insights-for-partsunlimited">Task 1: Set up Application Insights for PartsUnlimited</h3>

<p><strong>Step 1.</strong> To configure Application Insights with PartsUnlimited, please follow these steps: <a href="https://github.com/Microsoft/ApplicationInsights-aspnetcore/wiki/Getting-Started">Application Insights - Getting Started</a></p>

<p><strong>Step 2.</strong> Open command line that supports Git and navigate to the PartsUnlimited repository. Run the following commands to push your changes to the remote repository and trigger CI and CD:</p>
<pre><code class="language-Bash">git add .

git commit -m "added Application Insights"

git push
</code></pre>

<p>Now that the telemetry has been added to the web application, it may take a few minutes for Application Insights to refresh.</p>

<h3 id="task-2-view-real-time-results-for-user-telemetry-in-the-azure-portal">Task 2: View real-time results for user telemetry in the Azure portal</h3>

<p>Now that we’ve given Application Insights time to refresh, we can take a look at the usage data in the new Azure Portal. The Portal will show a variety of metrics out of the box, including number of sessions, users, and browser sessions.</p>

<blockquote>
  <p><strong>Note:</strong> Before you proceed, you need to generate data for the Application Insights instance by browsing the website for a few minutes.</p>
</blockquote>

<p><strong>Step 1.</strong> In an Internet browser, navigate to <a href="http://ms.portal.azure.com">http://ms.portal.azure.com</a> and
sign in with your credentials.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/prereq-step1.png" alt="" /></p>

<p><strong>Step 2.</strong> Click on the “More services” tile on the left column, and select “Application Insights”.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/prereq-step1.1.png" alt="" /></p>

<p><strong>Step 3.</strong> Click on the name of the telemetry that was created when you deployed the resource group using the Deployment template in the PartsUnlimited solution.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/prereq-step2.png" alt="" /></p>

<p><strong>Step 4.</strong> In the overview panel of the Application Insights instance, overall application health will be shown in server response time, page view load time, server requests, and failed requests. (Actual times may vary)</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step3.png" alt="" /></p>

<p><strong>Step 5.</strong> In the Application Insights instance blade, scroll down and click on the “Usage” tile. By drilling into usage, we can gauge how popular our web application is based on the number of distinct users, active sessions, and number of calls to trackPageView() (usually called once). Click on “Users” to view more information about the users.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step4.png" alt="" /></p>

<p><strong>Step 6.</strong> In the Users timeline, note the number of users, new users, and page views. Additionally, the unique count of users by country is recorded. Click the X in the upper-right corner to close the Users panel.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step6.png" alt="" /></p>

<p><strong>Step 7.</strong> Back in the overview panel of the Application Insights instance, click on the chart for Page View Load Time.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step7.png" alt="" /></p>

<p><strong>Step 8.</strong> In the Browsers timeline, note the receiving response time, client processing time, page load network time, send request time, server response time, and page views. Additionally, the average count of browser page load time is shown below the timeline. Click on the “Edit” button in the first timeline chart.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step8.png" alt="" /></p>

<p><strong>Step 9.</strong> In the Chart Details pane, scroll down to the Client area and uncheck all of the properties except for Receiving Response Time. Then, turn on the Grouping and select “Browser version” as the “group by” property. The Browsers timeline will change and show the average receiving response time broken down into the various browsers that were used to log into the site.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step9.png" alt="" /></p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step9b.png" alt="" /></p>

<p><strong>Step 10.</strong> Back in the Usage panel, and click on “Page views”.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step10.png" alt="" /></p>

<p><strong>Step 11.</strong> The Page Views panel will break down the total page views, number of users, and pages per session for the web application.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task2step11.png" alt="" /></p>

<h3 id="task-3-using-application-performance-monitoring-to-resolve-performance-issues">Task 3: Using Application Performance Monitoring to resolve performance issues</h3>

<p><strong>Step 1.</strong> In an Internet browser, navigate to the PartsUnlimited website that you previously deployed and go to the Recommendations page, such as http://partsunlimited.azurewebsites.net/home/recommendations.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step6.png" alt="" /> </p>

<p><strong>Step 2.</strong> In the Application Insights instance blade, scroll down and select the “Performance” tile to view performance monitoring
information.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step1.png" alt="" /></p>

<p><strong>Step 3.</strong> In the Performance panel, note the timeline. The timeline data may not show up immediately, so you will want to wait for a few minutes for the telemetry to collect performance data.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step2.png" alt="" /></p>

<p><strong>Step 4.</strong> Once data shows in the timeline, view the operations listed under the <strong>Average
of server response time by operation name</strong> section under the timeline. Click on the top operation in the list referring to the recommendations page to view details of that operation.</p>

<p><strong>Step 5.</strong> Drill down into the method that is affecting the slow performance. We now know where the slow performance is being caused in our code.</p>

<p><strong>Step 6.</strong> Using your preferred IDE or a text editor, open <code class="highlighter-rouge">HomeController.cs</code> and find the Recommendations method that is causing slow performance. At the top of the HomeController class, notice that the public int roco_count is set to 1000. Change that value to be 1.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step3.png" alt="" /></p>

<p><strong>Step 7.</strong>  Open command line in PartsUnlimited repository and run the following commands:</p>
<pre><code class="language-Bash">git add .

git commit -m "Changed roco_count from 1000 to 1 in HomeController.cs after being aware of slow perf in AI"

git push
</code></pre>
<blockquote>
  <p><strong>Note</strong> This will push the changes up to the remote repo and kick off a build automatically.</p>
</blockquote>

<p><strong>Step 8.</strong> Now that our changes have deployed to the website, open up a new incognito browser window (to prevent caching) and return to the recommendations page (http://partsunlimited.azurewebsites.net/home/recommendations).</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step6.png" alt="" /> </p>

<p><strong>Step 9.</strong> Return to the Application Insights performance monitoring view in the Azure Preview Portal and refresh the page.</p>

<p><img src="/PartsUnlimited/assets/usertelemetry/task3-step7.png" alt="" /> </p>

<p>In this lab, you learned how to sest up Application Insights telemetry to gain further insight into how users are behaving towards your web application, and drill down into performance monitoring data through Application Insights in the new Azure Portal.</p>

<p>Try these labs out for next steps:</p>

<ul>
  <li><a href="TestingProd">Testing in Production hands-on lab</a></li>
  <li><a href="UsageAnalysis">Usage Analysis with Application Insights</a></li>
</ul>

<p><strong>Further Resources</strong></p>

<p><a href="https://azure.microsoft.com/en-us/documentation/articles/app-insights-web-track-usage/">Usage analysis for web applications with Application Insights</a></p>


                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/Microsoft/PartsUnlimited">PartsUnlimited</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
    </body>
</html>
